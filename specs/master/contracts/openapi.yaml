openapi: 3.1.0
info:
  title: BrainForge PDF Processing API
  description: API endpoints for PDF ingestion and processing with dockling integration
  version: 1.0.0
  contact:
    name: BrainForge Development Team
    email: dev@brainforge.example.com

servers:
  - url: http://localhost:8000/api
    description: Development server

paths:
  /ingestion/pdf:
    post:
      summary: Submit PDF for ingestion
      description: Upload a PDF document for processing and integration into knowledge base
      tags:
        - PDF Ingestion
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: PDF file to process
                source_url:
                  type: string
                  description: Original source URL (optional)
                tags:
                  type: array
                  items:
                    type: string
                  description: Initial tags for classification
                priority:
                  type: string
                  enum: [low, normal, high]
                  default: normal
                  description: Processing priority
      responses:
        '202':
          description: PDF accepted for processing
          content:
            application/json:
              schema:
                type: object
                properties:
                  task_id:
                    type: string
                    format: uuid
                    description: Unique identifier for processing task
                  status:
                    type: string
                    enum: [accepted, validating]
                    description: Initial processing status
                  estimated_completion:
                    type: string
                    format: date-time
                    description: Estimated completion time
        '400':
          description: Invalid PDF file or parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '413':
          description: PDF file too large (>100MB)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ingestion/pdf/{task_id}:
    get:
      summary: Get PDF processing status
      description: Retrieve current status and results of PDF processing task
      tags:
        - PDF Ingestion
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Processing task identifier
      responses:
        '200':
          description: Processing status and results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PDFProcessingStatus'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ingestion/pdf/{task_id}/retry:
    post:
      summary: Retry failed PDF processing
      description: Retry processing for a failed PDF ingestion task
      tags:
        - PDF Ingestion
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Processing task identifier
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                extraction_method:
                  type: string
                  enum: [dockling_basic, dockling_advanced]
                  description: Specific extraction method to use
      responses:
        '200':
          description: Retry initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PDFProcessingStatus'
        '404':
          description: Task not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Task not in failed state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /ingestion/pdf/batch:
    post:
      summary: Submit multiple PDFs for batch processing
      description: Upload multiple PDF documents for batch processing
      tags:
        - PDF Ingestion
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: PDF files to process
                batch_name:
                  type: string
                  description: Name for batch processing group
      responses:
        '202':
          description: Batch processing accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  batch_id:
                    type: string
                    format: uuid
                    description: Batch processing identifier
                  task_count:
                    type: integer
                    description: Number of PDFs accepted
                  estimated_completion:
                    type: string
                    format: date-time
                    description: Estimated completion time

components:
  schemas:
    PDFProcessingStatus:
      type: object
      properties:
        task_id:
          type: string
          format: uuid
          description: Processing task identifier
        status:
          type: string
          enum: [validating, extracting_metadata, extracting_text, assessing_quality, summarizing, classifying, awaiting_review, integrated, failed]
          description: Current processing status
        progress:
          type: integer
          minimum: 0
          maximum: 100
          description: Processing progress percentage
        pdf_metadata:
          $ref: '#/components/schemas/PDFMetadata'
        extracted_text_preview:
          type: string
          description: First 500 characters of extracted text
        quality_score:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Text extraction quality score
        estimated_remaining_time:
          type: integer
          description: Estimated remaining processing time in seconds
        errors:
          type: array
          items:
            type: string
          description: Processing errors encountered
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PDFMetadata:
      type: object
      properties:
        page_count:
          type: integer
          description: Number of pages in PDF
        author:
          type: string
          nullable: true
          description: Document author
        title:
          type: string
          nullable: true
          description: Document title
        subject:
          type: string
          nullable: true
          description: Document subject
        creation_date:
          type: string
          format: date-time
          nullable: true
          description: PDF creation date
        modification_date:
          type: string
          format: date-time
          nullable: true
          description: PDF modification date
        pdf_version:
          type: string
          description: PDF version
        encryption_status:
          type: string
          enum: [none, password, certificate]
          description: Encryption status
        extraction_method:
          type: string
          description: Text extraction method used
        extraction_quality_score:
          type: number
          format: float
          description: Quality score of text extraction

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
        details:
          type: object
          description: Additional error details
        timestamp:
          type: string
          format: date-time
          description: When the error occurred

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []